# rese-reservation

`rese-reservation` ã¯ã€ä¼æ¥­ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®é£²é£Ÿåº—å°‚ç”¨ã®äºˆç´„ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚  
å¤–éƒ¨äºˆç´„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ä¾å­˜ã›ãšã€æ‰‹æ•°æ–™ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã—ãªãŒã‚‰é«˜æ©Ÿèƒ½ãªäºˆç´„ä½“é¨“ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ URL

## ğŸ›  ä¸»ãªæ©Ÿèƒ½

### ğŸ” ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£

-   ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆFortify + ãƒ¡ãƒ¼ãƒ«èªè¨¼ï¼‰
-   ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
-   ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ãƒ»å‰Šé™¤
-   ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äºˆç´„ä¸€è¦§å–å¾—ãƒ»å¤‰æ›´ãƒ»å‰Šé™¤

### ğŸ½ é£²é£Ÿåº—é–¢é€£

-   ä¸€è¦§ãƒ»è©³ç´°å–å¾—
-   ã‚¨ãƒªã‚¢ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»åº—åã«ã‚ˆã‚‹æ¤œç´¢
-   åº—èˆ—ã¸ã®è©•ä¾¡ï¼ˆ5 æ®µéšï¼‹ã‚³ãƒ¡ãƒ³ãƒˆï¼‰

### ğŸ“… äºˆç´„é–¢é€£

-   äºˆç´„è¿½åŠ ãƒ»å¤‰æ›´ãƒ»å‰Šé™¤
-   äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆå½“æ—¥æœã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼‰

### âš™ ç®¡ç†æ©Ÿèƒ½

-   æ¨©é™ï¼šç®¡ç†è€… / åº—èˆ—ä»£è¡¨è€… / ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼
-   åº—èˆ—ä»£è¡¨è€…ï¼šåº—èˆ—æƒ…å ±ç®¡ç†ãƒ»äºˆç´„ç¢ºèª
-   ç®¡ç†è€…ï¼šä»£è¡¨è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡

### ğŸ’³ æ±ºæ¸ˆæ©Ÿèƒ½

-   Stripe ã‚’åˆ©ç”¨ã—ãŸã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ±ºæ¸ˆ

### ğŸ–¼ ãã®ä»–

-   ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹åº—èˆ—ç”»åƒä¿å­˜
-   QR ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¥åº—ãƒã‚§ãƒƒã‚¯

## ä½œæˆã—ãŸç›®çš„

æ¨¡æ“¬æ¡ˆä»¶ã‚’é€šã—ã¦å®Ÿè·µã«è¿‘ã„é–‹ç™ºçµŒé¨“ã‚’ç©ã¿ã€å®šç¾©ã•ã‚ŒãŸè¦ä»¶ã‚’å®Ÿè£…ã™ã‚‹èƒ½åŠ›ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ã€‚

## ä½¿ç”¨æŠ€è¡“ï¼ˆå®Ÿè¡Œç’°å¢ƒï¼‰

-   PHP7.4
-   Laravel8.83.27
-   MySQL8.0.26

## ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

## ER å›³

![alt text](.drawio.png)

## ç’°å¢ƒæ§‹ç¯‰

### **1.ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**

GitHub ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```
git clone https://github.com/chiemi123/rese-reservation
```

```
cd rese-reservation
```

### **2.Docker ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**

Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose up -d --build
```

### **3.Laravel ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ php ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

```
docker-compose exec php bash
```

Laravel ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Laravel ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã—ã¾ã™ã€‚

```
composer install
```

.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€.env.example ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```
cp .env.example .env
```

### **4.ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ä½œæˆ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```
php artisan key:generate
```

### **5.ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
php artisan migrate
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œå¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

http://localhost

æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
sudo chmod -R 777 *
```

### **6.ã‚·ãƒ¼ãƒ€ãƒ¼ã®å®Ÿè¡Œ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
php artisan db:seed
```

## ğŸ”‘ èªè¨¼æ©Ÿèƒ½ã«ã¤ã„ã¦

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã®ä»•çµ„ã¿ã« [Laravel Fortify](https://laravel.com/docs/fortify) ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ä½¿ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³

-   Laravel Fortify v1.19.1

### ä¸»ãªæ©Ÿèƒ½

-   ãƒ­ã‚°ã‚¤ãƒ³ãƒ»æ–°è¦ç™»éŒ²
-   ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒªã‚»ãƒƒãƒˆ
-   ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹èªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### å°å…¥æ‰‹é †

Fortify ã¯ `composer install` å®Ÿè¡Œæ™‚ã«è‡ªå‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚  
ã¾ãŸã€ç’°å¢ƒæ§‹ç¯‰æ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé©åˆ‡ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚Œã°ã€è¿½åŠ ã®è¨­å®šã¯ä¸è¦ã§ã™ã€‚

## ğŸ”‘ ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç”¨ï¼‰

ä»¥ä¸‹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ãã‚Œãã‚Œã®æ¨©é™ã§ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã§ã™ã€‚

### ğŸ‘¤ ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼

-   **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**: `user@example.com`
-   **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: `password123`

### ğŸª åº—èˆ—ä»£è¡¨è€…

-   **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**: `owner@example.com`
-   **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: `password123`

### ğŸ‘‘ ç®¡ç†è€…

-   **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**: `admin@example.com`
-   **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: `password12345`

## **å•†å“ç”»åƒã®ä¿å­˜ä»•æ§˜**

æœ¬ã‚¢ãƒ—ãƒªã§ã¯ã€å‡ºå“ã•ã‚ŒãŸå•†å“ã®ç”»åƒã¯ **Laravel ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆstorage ãƒ•ã‚©ãƒ«ãƒ€ï¼‰** ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚  
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `storage/app/public/item_images` ã«ç”»åƒãŒæ ¼ç´ã•ã‚Œ  
`public/storage` ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€Web ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

#### **1. ç”»åƒã®ä¿å­˜å…ˆ**

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                      | èª¬æ˜                               |
| --------------------------------- | ---------------------------------- |
| `storage/app/public/item_images/` | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã®ä¿å­˜å ´æ‰€   |
| `public/storage/item_images/`     | Web ã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ |

ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®ä½œæˆ

ç”»åƒã‚’ public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
php artisan storage:link
```

## MailHog ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰

MailHog ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€é–‹ç™ºç’°å¢ƒã§é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªã§ãã¾ã™ã€‚

MailHog ã®èµ·å‹•  
MailHog ã¯ docker-compose up -d ã®æ™‚ç‚¹ã§èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚  
ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã§ãã¾ã™ã€‚

http://localhost:8025

.env ã®ãƒ¡ãƒ¼ãƒ«è¨­å®š
.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```env

MAIL_MAILER=smtp
MAIL_HOST=mailhog
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="example@example.com"
MAIL_FROM_NAME="${APP_NAME}"

```

ãã®å¾Œã€Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å†èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose restart
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

nginx / Apache ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```
docker-compose up -d
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

php artisan serve ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```
docker-compose exec app php artisan serve --host=0.0.0.0 --port=8000
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

## Stripe æ±ºæ¸ˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### **1. Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**

Stripe ã® API ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã¾ãš **Stripe ã®å…¬å¼ã‚µã‚¤ãƒˆã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ** ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ğŸ”¹ **Stripe å…¬å¼ã‚µã‚¤ãƒˆ:** [https://dashboard.stripe.com/register](https://dashboard.stripe.com/register)

1. ä¸Šè¨˜ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ **Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**
2. [Stripe ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://dashboard.stripe.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
3. **ã€Œé–‹ç™ºè€…ã€ â†’ ã€ŒAPI ã‚­ãƒ¼ã€** ã‹ã‚‰ **ã€Œå…¬é–‹å¯èƒ½ã‚­ãƒ¼ã€ (`STRIPE_KEY`)** ã¨ **ã€Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã€ (`STRIPE_SECRET`)** ã‚’å–å¾—

### **2. `.env` ã« Stripe ã® API ã‚­ãƒ¼ã‚’è¨­å®š**

Stripe ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ã§ å…¬é–‹å¯èƒ½ã‚­ãƒ¼ ã¨ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ ã‚’å–å¾—ã—ã€.env ã«è¨­å®šã—ã¾ã™ã€‚

```ini

STRIPE_KEY=your_stripe_publishable_key
STRIPE_SECRET=your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret

```

STRIPE_WEBHOOK_SECRET ã®å–å¾—æ–¹æ³•  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€Webhook ã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe listen --forward-to http://nginx/webhook/stripe
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
> Ready! You are using Stripe API Version [2025-01-27.acacia].
Your webhook signing secret is whsec_xxxxxxxxxxxxxxxxxxxxxxxx
(^C to quit)
```

ã“ã® whsec\_ ã‹ã‚‰å§‹ã¾ã‚‹å€¤ï¼ˆwhsec_xxxxxxxxxxxxxxxxxxxxxxxxï¼‰ã‚’ .env ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

ãã®å¾Œã€Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å†èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose restart
```

ã¾ãŸã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
docker-compose up -d
```

### **3. Stripe ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€`stripe/stripe-php` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php composer show stripe/stripe-php
```

ã‚‚ã— stripe/stripe-php ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php composer require stripe/stripe-php:^12.0
```

### **4.stripe ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ**

Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ stripe login ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  
åˆå›ã®ã¿ Stripe ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã®ã§ã€èªè¨¼ã‚’è¡Œã„ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe login
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€Webhook ã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe listen --forward-to http://nginx/webhook/stripe

```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€Webhook ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe trigger checkout.session.completed
```

#### **1.ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®ãƒ†ã‚¹ãƒˆ**

Stripe ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ã€ä»¥ä¸‹ã®ã‚«ãƒ¼ãƒ‰ç•ªå·ã‚’ä½¿ç”¨ã—ã¦æ±ºæ¸ˆãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚

| ã‚«ãƒ¼ãƒ‰ç•ªå·          | ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥ | æˆåŠŸ or å¤±æ•—        |
| ------------------- | ---------- | ------------------- |
| 4242 4242 4242 4242 | Visa       | âœ… æˆåŠŸ             |
| 4000 0000 0000 0002 | Visa       | âŒ å¤±æ•—ï¼ˆæ±ºæ¸ˆæ‹’å¦ï¼‰ |
| 5555 5555 5555 4444 | Mastercard | âœ… æˆåŠŸ             |

#### **2.ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã®æ±ºæ¸ˆãƒ†ã‚¹ãƒˆ**

ä»¥ä¸‹ã®æ‰‹é †ã§æ±ºæ¸ˆãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚

â‘  ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã‚’é¸æŠã—ã€è³¼å…¥ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚  
stripe æ±ºæ¸ˆç”»é¢ã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åå‰ã‚’å…¥åŠ›å¾Œã€æ”¯æ‰•ã†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚

â‘¡ Webhook ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å®Ÿéš›ã«ã€Œã‚³ãƒ³ãƒ“ãƒ‹ã§æ”¯æ‰•ã„ãŒå®Œäº†ã—ãŸã€çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™ã€‚

```
docker exec -it stripe-cli stripe trigger payment_intent.succeeded
```

ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã§ã¯ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®ã‚ˆã†ã«ã€Œæ±ºæ¸ˆå®Œäº†ãƒšãƒ¼ã‚¸ã€ã«ã¯è‡ªå‹•ã§é·ç§»ã—ã¾ã›ã‚“ã€‚  
ãã®ãŸã‚ã€ä»¥ä¸‹ã®æ–¹æ³•ã§è³¼å…¥å®Œäº†ã‚’æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ğŸ”¹ æ–¹æ³• â‘ ï¼šãƒã‚¤ãƒšãƒ¼ã‚¸ (http://localhost/mypage) ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚  
è³¼å…¥ã—ãŸå•†å“ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ğŸ”¹ æ–¹æ³• â‘¡ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§è³¼å…¥ãƒ†ãƒ¼ãƒ–ãƒ«ã® status ãŒ completed ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php php artisan tinker
```

```
use App\Models\Purchase;
```

```
Purchase::where('status', 'completed')->get();
```
